# Домашнее задание к занятию «Операционные системы.Лекция 1»

 1.Какой системный вызов делает команда cd? В прошлом ДЗ вы выяснили, что cd не является самостоятельной программой. Это shell builtin, поэтому запустить strace непосредственно на cd не получится. Вы можете запустить strace на /bin/bash -c 'cd /tmp'. В этом случае увидите полный список системных вызовов, которые делает сам bash при старте.Вам нужно найти тот единственный, который относится именно к cd. Обратите внимание, что strace выдаёт результат своей работы в поток stderr, а не в stdout.


*Ответ: chdir ()*


2.Попробуйте использовать команду file на объекты разных типов в файловой системе. Например:

 >vagrant@netology1:~$ file /dev/tty
>/dev/tty: character special (5/0)
>vagrant@netology1:~$ file /dev/sda
>/dev/sda: block special (8/0)
>vagrant@netology1:~$ file /bin/bash
>/bin/bash: ELF 64-bit LSB shared object, x86-64

Используя strace, выясните, где находится база данных file, на основании которой она делает свои догадки.


*Ответ: etc/magic.mgc etc/magic*

3.Предположим, приложение пишет лог в текстовый файл. Этот файл оказался удалён (deleted в lsof), но сказать сигналом приложению переоткрыть файлы или просто перезапустить приложение возможности нет. 
 Так как приложение продолжает писать в удалённый файл, место на диске постепенно заканчивается. 
 Основываясь на знаниях о перенаправлении потоков, предложите способ обнуления открытого удалённого файла, чтобы освободить место на файловой системе.
 
 *Ответ: Найти дескриптор файла по пиду, а потом записать пустую строку в дескриптор с помощью перенаправления ECHO echo '' > /proc/ <pid>/fd/ <filediscriptor>*
  
 4.Занимают ли зомби-процессы ресурсы в ОС (CPU, RAM, IO)?

*Ответ: Зомби не занимают памяти (как процессы-сироты), но блокируют записи в таблице процессов, размер которой ограничен для каждого пользователя и системы в целом.*

5.В IO Visor BCC есть утилита opensnoop:

>root@vagrant:~# dpkg -L bpfcc-tools | grep sbin/opensnoop
>/usr/sbin/opensnoop-bpfcc
На какие файлы вы увидели вызовы группы open за первую секунду работы утилиты? 
Воспользуйтесь пакетом bpfcc-tools для Ubuntu 20.04. Дополнительные сведения по установке по ссылке.

*Ответ:*
	
```
vagrant@vagrant:/$ sudo opensnoop-bpfcc -d 1
PID    COMM               FD ERR PATH
835    vminfo              5   0 /var/run/utmp
```
6.Какой системный вызов использует uname -a? Приведите цитату из man по этому системному вызову, 
где описывается альтернативное местоположение в /proc и где можно узнать версию ядра и релиз ОС.

*Ответ:*
uname({sysname="Linux", nodename="vagrant" в man proс это можно получить:
```
/proc/sys/kernel/hostname 
/proc/sys/kernel/domainname
/proc/sys/kernel/osrelease
/proc/sys/kernel/ostype
```
7.Чем отличается последовательность команд через ; и через && в bash? Например:
```
root@netology1:~# test -d /tmp/some_dir; echo Hi
Hi
root@netology1:~# test -d /tmp/some_dir && echo Hi
root@netology1:~#
Есть ли смысл использовать в bash &&, если применить set -e?
```
*Ответ:Оба оператора нужны чтобы последовательно выполнить несколько команд. 
При использовании ; происходит последовательное выполнение всех команд
При использовании $$ выполнение команд прекратится, если одна завершится ошибкой
Если использовать set -e , то происходит прерывание и может быть выполнена одна команда по обработке прерывания.
Использовать set - e можно вместо $$, но в справочнике bash пишут, что программисты считают, что нужно тщательнее программировать, чем отлавливать таким способом ошибки*
	

8.Из каких опций состоит режим bash set -euxo pipefail, и почему его хорошо было бы использовать в сценариях?

*Ответ:
Set используется для отладки скриптов.
 -x показывает трассировку скрипта, отображает команды с их аргументами,
 -u отображать неустановленные переменные,
-e приведет к немедленному завершению сценария bash в случае сбоя команды.
если добавить к нему еще и -o pipefail, то этот конкретный параметр устанавливает код выхода конвейера на
 код выхода самой правой команды для выхода с ненулевым статусом или на ноль, если все команды конвейера завершаются успешно.
Эту комбинацию рекомендуют использовать для более детатьно отладки скриптов,  похоже на высокоуровневую обработку

9.Используя -o stat для ps, определите, какой наиболее часто встречающийся статус у процессов в системе. 
В man ps изучите (/PROCESS STATE CODES), что значат дополнительные к основной заглавной букве статуса процессов. 
Его можно не учитывать при расчёте (считать S, Ss или Ssl равнозначными).

*Ответ:*
```
vagrant@vagrant:/$ ps -o stat
STAT
Ss
R+
```
